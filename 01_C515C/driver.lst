C51 COMPILER V9.02   DRIVER                                                                11/03/2010 23:28:07 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE DRIVER
OBJECT MODULE PLACED IN driver.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\common\driver.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\driver.lst) OBJ
                    -ECT(driver.obj)

line level    source

   1          
   2          #include "driver.h"
   3          
   4          struct driver_registration 
   5          {
   6                  struct bus_driver       *driver;
   7                  unsigned int             ref_count;
   8          };
   9          
  10          struct driver_registration drivers[MAX_DRIVERS];
  11          
  12          /*int _register_driver(bus_driver_t *driver)   TODO: ????? zwei Funktionen register_driver?
  13          {
  14                  int rc = 0;
  15          
  16                  if (driver != NULL && driver->probe != NULL)
  17                  {
  18                          rc = driver->probe();
  19                  }
  20          
  21                  return rc;
  22          }  */
  23          
  24          int _unregister_driver(bus_driver_t *driver)
  25          {
  26   1              int rc = 0;
  27   1      
  28   1              if (driver != NULL && driver->shutdown != NULL)
  29   1              {
  30   2                      rc = driver->shutdown();
*** WARNING C209 IN LINE 30 OF SRC\COMMON\DRIVER.C: 'function': too few actual parameters
  31   2              }
  32   1      
  33   1              return rc;
  34   1      }
  35          
  36          int check_for_driver(bus_driver_type_t type)
  37          {
  38   1              return drivers[type].driver != NULL;
  39   1      }
  40          
  41          int register_driver(bus_driver_type_t type, bus_driver_t *driver)
  42          {
  43   1              int rc = 0;
  44   1      
  45   1              /* Do we already have this driver? */
  46   1              if (!check_for_driver(type))
  47   1              {
  48   2                      drivers[type].driver = driver;
  49   2                      drivers[type].ref_count = 0;
  50   2                      rc = SUCCESS;
  51   2              }
  52   1              else
  53   1              {
C51 COMPILER V9.02   DRIVER                                                                11/03/2010 23:28:07 PAGE 2   

  54   2                      rc = ERROR_COULD_NOT_REGISTER_DRIVER;
  55   2              }
  56   1              
  57   1              return rc;
  58   1      }
  59          
  60          struct bus_driver* require_driver(bus_driver_type_t type)
  61          {
  62   1              struct bus_driver *driver = NULL;
  63   1      
  64   1              if (check_for_driver(type))
  65   1              {
  66   2                      drivers[type].ref_count++;
  67   2                      driver = drivers[type].driver;
  68   2              }
  69   1      
  70   1              return driver;
  71   1      }
  72          
  73          void release_driver(bus_driver_type_t type)
  74          {
  75   1              if (check_for_driver(type))
  76   1              {
  77   2                      if (drivers[type].ref_count > 0)
  78   2                      {
  79   3                              drivers[type].ref_count--;
  80   3                      }
  81   2              }
  82   1      }
  83          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    318    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     50      11
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
